---
phase: 02-data-layer
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/data/cities.json, src/lib/data.ts, src/lib/currency.ts]
---

<objective>
Create data loading utilities and populate initial sample city data.

Purpose: Enable features to access typed city data with proper loading utilities.
Output: Sample JSON data for 2 CIS + 2 EU cities, data loading functions, currency helpers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-data-layer/02-01-SUMMARY.md
@src/types/index.ts

**Tech stack available:** Next.js 16.1.4, React 19.2.3, TypeScript 5
**Types available:** City, CityMetrics, CityWithMetrics, CityIndex, MoneyAmount, etc.

**Sample cities to create:**
- CIS: Moscow, Tbilisi (diverse economies)
- EU: Berlin, Lisbon (Western + Southern Europe)

Use realistic approximate data - exact accuracy not required for sample data.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sample city data JSON</name>
  <files>src/data/cities.json</files>
  <action>
Create JSON file with 4 sample cities (Moscow, Tbilisi, Berlin, Lisbon).

Structure for each city:
```json
{
  "id": "berlin",
  "name": "Berlin",
  "country": "Germany",
  "countryCode": "DE",
  "region": "eu",
  "coordinates": { "lat": 52.52, "lng": 13.405 },
  "currency": { "code": "EUR", "symbol": "€", "name": "Euro" },
  "population": 3645000,
  "timezone": "Europe/Berlin",
  "metrics": {
    "salary": { "average": { "local": 3500, "usd": 3800 }, ... },
    "rent": { ... },
    ...
    "updatedAt": "2026-01-01",
    "sources": ["Numbeo estimates", "Local statistics"]
  },
  "historical": {
    "averageSalary": [
      { "year": 2023, "value": { "local": 3200, "usd": 3400 } },
      { "year": 2024, "value": { "local": 3350, "usd": 3600 } },
      { "year": 2025, "value": { "local": 3500, "usd": 3800 } }
    ]
  }
}
```

Use approximate realistic values:
- Berlin: EUR, ~€3500 avg salary, ~€1200 1BR rent
- Lisbon: EUR, ~€1400 avg salary, ~€900 1BR rent
- Moscow: RUB, ~₽120000 avg salary, ~₽60000 1BR rent
- Tbilisi: GEL, ~₾3500 avg salary, ~₾1500 1BR rent

Include 3 years of historical data for averageSalary, rentOneBedroom, and inflation.
Do NOT over-engineer - sample data to prove the schema works.
  </action>
  <verify>JSON is valid (node -e "JSON.parse(require('fs').readFileSync('src/data/cities.json'))")</verify>
  <done>4 cities with complete metrics, valid JSON, realistic approximate values</done>
</task>

<task type="auto">
  <name>Task 2: Create data loading utilities</name>
  <files>src/lib/data.ts</files>
  <action>
Create typed data loading functions:

1. `getAllCities(): CityWithMetrics[]` - return all cities from JSON
2. `getCityById(id: string): CityWithMetrics | undefined` - find by slug
3. `getCityIndex(): CityIndex[]` - lightweight list for navigation/maps
4. `getCitiesByRegion(region: 'cis' | 'eu' | 'other'): CityWithMetrics[]` - filter by region

Implementation:
- Import JSON directly (Next.js supports JSON imports)
- Type cast with `as CityWithMetrics[]`
- Export functions for use in components

Keep simple - no caching, no async (static JSON data).
Do NOT add error handling for missing data - trust the JSON.
  </action>
  <verify>Create a test file and verify functions return typed data correctly</verify>
  <done>All 4 functions exported, properly typed, return correct data</done>
</task>

<task type="auto">
  <name>Task 3: Create currency formatting utilities</name>
  <files>src/lib/currency.ts</files>
  <action>
Create currency formatting helpers:

1. `formatMoney(amount: MoneyAmount, showBoth?: boolean): string`
   - Default: format local currency ("€3,500" or "₽120,000")
   - showBoth=true: "€3,500 ($3,800)"
   - Use Intl.NumberFormat for proper locale formatting

2. `formatCurrency(value: number, currencyCode: string): string`
   - Format any number with currency symbol
   - Use Intl.NumberFormat with currency style

3. `formatPercent(value: number): string`
   - Format percentage values (for inflation, changes)
   - Example: 0.054 → "+5.4%"

Keep minimal - these are display utilities only.
Do NOT add conversion functions - USD values are pre-calculated in data.
  </action>
  <verify>npx tsc --noEmit passes, manual test formatting output</verify>
  <done>3 formatting functions exported, proper currency symbols, locale-aware formatting</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] cities.json contains 4 cities with complete metrics
- [ ] Data loading functions return typed arrays
- [ ] Currency formatting produces readable output
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Sample data proves schema works end-to-end
- Utilities ready for consumption by UI components
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-layer/02-02-SUMMARY.md`
</output>

---
phase: 05-rankings-table
plan: 02
type: execute
depends_on: ["05-01"]
files_modified: [src/components/Rankings/RankingsTable.tsx, src/components/Rankings/RankingsFilters.tsx, src/components/Rankings/index.ts]
---

<objective>
Add filtering options to the rankings table for region filtering and column visibility.

Purpose: Allow users to focus on specific regions and customize which metrics they see.
Output: Rankings table with region filter and cleaner mobile experience.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/05-rankings-table/05-01-SUMMARY.md
@src/components/Rankings/RankingsTable.tsx

**Current state:** RankingsTable with sorting works
**Additions needed:**
- Region filter (All, CIS, EU)
- Filter state management
- Optional: column visibility toggles

**Simplification:** Keep it simple - just add region filter. Column visibility can be added later if needed.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RankingsFilters component</name>
  <files>src/components/Rankings/RankingsFilters.tsx, src/components/Rankings/index.ts</files>
  <action>
Create a filter controls component:

1. Props interface:
   ```typescript
   interface RankingsFiltersProps {
     selectedRegion: Region | 'all';
     onRegionChange: (region: Region | 'all') => void;
     cityCount: number;
   }
   ```

2. Region filter buttons:
   - "All" button (default)
   - "CIS" button (amber styled)
   - "EU" button (blue styled)
   - Active state: filled background
   - Inactive state: outline/ghost

3. Display city count:
   - "Showing X cities" text

4. Layout:
   - Horizontal row with filter buttons
   - City count on the right
   - flex justify-between items-center

5. Update barrel export
  </action>
  <verify>Filter buttons render and are styled correctly</verify>
  <done>RankingsFilters component with region buttons</done>
</task>

<task type="auto">
  <name>Task 2: Integrate filters into RankingsTable</name>
  <files>src/components/Rankings/RankingsTable.tsx</files>
  <action>
Add filter state and logic to RankingsTable:

1. Add filter state:
   ```typescript
   const [selectedRegion, setSelectedRegion] = useState<Region | 'all'>('all');
   ```

2. Filter cities before sorting:
   ```typescript
   const filteredCities = useMemo(() => {
     if (selectedRegion === 'all') return cities;
     return cities.filter(city => city.region === selectedRegion);
   }, [cities, selectedRegion]);
   ```

3. Sort filtered cities (update sortedCities to use filteredCities)

4. Render RankingsFilters above table:
   ```tsx
   <div className="space-y-4">
     <RankingsFilters
       selectedRegion={selectedRegion}
       onRegionChange={setSelectedRegion}
       cityCount={filteredCities.length}
     />
     <div className="overflow-x-auto ...">
       <table>...</table>
     </div>
   </div>
   ```

5. Update empty state to reflect filter:
   - "No cities match the selected filter"
  </action>
  <verify>Filtering by region updates the table correctly</verify>
  <done>RankingsTable filters cities by selected region</done>
</task>

<task type="auto">
  <name>Task 3: Final polish and verification</name>
  <files>src/components/Rankings/RankingsTable.tsx, src/components/Rankings/RankingsFilters.tsx</files>
  <action>
Final polish:

1. Ensure filter persists when sorting changes

2. Smooth transitions:
   - Filter buttons: transition-colors
   - Table rows appearing/disappearing (optional, don't over-engineer)

3. Accessibility:
   - aria-pressed on filter buttons
   - Focus states visible

4. Test all combinations:
   - All regions + each sort field
   - CIS filter + each sort field
   - EU filter + each sort field
  </action>
  <verify>All filter/sort combinations work correctly</verify>
  <done>Rankings table fully functional with filters and sorting</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] "All" filter shows all cities
- [ ] "CIS" filter shows only CIS cities
- [ ] "EU" filter shows only EU cities
- [ ] City count updates with filter
- [ ] Sorting works with filters applied
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Rankings page has working filters
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-rankings-table/05-02-SUMMARY.md`
</output>

---
phase: 05-rankings-table
plan: 01
type: execute
depends_on: []
files_modified: [src/app/rankings/page.tsx, src/components/Rankings/RankingsTable.tsx, src/components/Rankings/index.ts]
---

<objective>
Build a sortable rankings table showing all cities with key cost of living metrics.

Purpose: Allow users to compare cities at a glance and sort by different criteria.
Output: Functional /rankings page with sortable table of all cities.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/lib/data.ts
@src/types/city.ts
@src/types/metrics.ts

**Data available:** getAllCities() returns CityWithMetrics[]
**Key metrics to display:**
- City name + country
- Average salary (local + USD)
- 1BR rent (local + USD)
- Property price per sqm (local + USD)
- Region badge

**Design considerations:**
- Table needs to be responsive (horizontal scroll on mobile or card view)
- Sortable by clicking column headers
- Default sort: by salary (USD, descending)
- Links to city detail pages
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RankingsTable component</name>
  <files>src/components/Rankings/RankingsTable.tsx, src/components/Rankings/index.ts</files>
  <action>
Create the core rankings table component:

1. Create directory: src/components/Rankings/

2. Props interface:
   ```typescript
   interface RankingsTableProps {
     cities: CityWithMetrics[];
   }
   ```

3. State for sorting:
   ```typescript
   type SortField = 'name' | 'salary' | 'rent' | 'property';
   type SortDirection = 'asc' | 'desc';

   const [sortField, setSortField] = useState<SortField>('salary');
   const [sortDirection, setSortDirection] = useState<SortDirection>('desc');
   ```

4. Sort logic:
   - Sort cities array based on current sort field and direction
   - Use USD values for numeric comparisons (consistent cross-currency)
   - useMemo for sorted cities array

5. Table structure:
   ```tsx
   <table className="min-w-full">
     <thead>
       <tr>
         <th onClick={() => handleSort('name')}>City</th>
         <th onClick={() => handleSort('salary')}>Avg. Salary</th>
         <th onClick={() => handleSort('rent')}>1BR Rent</th>
         <th onClick={() => handleSort('property')}>Property/sqm</th>
       </tr>
     </thead>
     <tbody>
       {sortedCities.map(city => (
         <tr key={city.id}>
           <td>
             <Link href={`/city/${city.id}`}>{city.name}</Link>
             <span>{city.country}</span>
             <RegionBadge region={city.region} />
           </td>
           <td>{formatMoney(city.metrics.salary.average, ...)}</td>
           <td>{formatMoney(city.metrics.rent.oneBedroom, ...)}</td>
           <td>{formatMoney(city.metrics.property.cityCenter, ...)}</td>
         </tr>
       ))}
     </tbody>
   </table>
   ```

6. Sort indicator in headers:
   - Show ▲ or ▼ arrow next to active sort column
   - Style: text-gray-400 for inactive, text-blue-600 for active

7. Styling:
   - Hover effect on rows
   - Alternating row colors (optional)
   - Sticky header (optional)
   - Responsive: horizontal scroll container on mobile

8. Create barrel export: src/components/Rankings/index.ts
  </action>
  <verify>Table renders with all cities, clicking headers sorts data</verify>
  <done>RankingsTable component with working sort functionality</done>
</task>

<task type="auto">
  <name>Task 2: Build rankings page</name>
  <files>src/app/rankings/page.tsx</files>
  <action>
Replace placeholder with full rankings page:

1. Import data and components:
   ```typescript
   import { getAllCities } from '@/lib/data';
   import { RankingsTable } from '@/components/Rankings';
   ```

2. Page structure:
   ```tsx
   <div className="space-y-6">
     <div>
       <h1 className="text-3xl font-bold">City Rankings</h1>
       <p className="text-gray-600 mt-2">
         Compare cities by cost of living metrics. Click column headers to sort.
       </p>
     </div>

     <RankingsTable cities={cities} />
   </div>
   ```

3. Metadata:
   ```typescript
   export const metadata: Metadata = {
     title: 'City Rankings - KABALA',
     description: 'Compare and rank cities by salary, rent, and cost of living.',
   };
   ```

4. This is a client component due to useState for sorting
   - Either make RankingsTable a client component ('use client')
   - Or pass sorted data from server with URL params for sort state
   - Simpler: Make RankingsTable a client component
  </action>
  <verify>Page loads with table showing all cities, sorting works</verify>
  <done>Rankings page displays sortable table of all cities</done>
</task>

<task type="auto">
  <name>Task 3: Add responsive design and polish</name>
  <files>src/components/Rankings/RankingsTable.tsx</files>
  <action>
Ensure table works well on all screen sizes:

1. Mobile considerations:
   - Wrap table in horizontal scroll container:
     `<div className="overflow-x-auto">`
   - Or: switch to card layout on mobile (more work, optional)

2. Table styling polish:
   - Header: bg-gray-50, sticky top-0
   - Rows: hover:bg-gray-50 transition
   - Cell padding: px-4 py-3
   - Border: divide-y divide-gray-200

3. City cell layout:
   - City name as link (text-blue-600 hover:underline)
   - Country on same line or below (text-gray-500 text-sm)
   - Region badge inline

4. Number alignment:
   - Right-align numeric columns
   - Use tabular-nums for consistent width

5. Empty state (if no cities):
   - Show message: "No cities to display"
  </action>
  <verify>Table looks good on desktop and mobile, all interactions smooth</verify>
  <done>Rankings table is polished and responsive</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /rankings shows table with all cities
- [ ] Clicking "Avg. Salary" header sorts by salary
- [ ] Clicking "1BR Rent" header sorts by rent
- [ ] Clicking "Property/sqm" header sorts by property price
- [ ] Sort direction toggles on repeated clicks
- [ ] City names link to detail pages
- [ ] Table scrolls horizontally on mobile
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Rankings table fully functional with sorting
</success_criteria>

<output>
After completion, create `.planning/phases/05-rankings-table/05-01-SUMMARY.md`
</output>

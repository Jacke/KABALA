---
phase: 07-budget-calculator
plan: 01
type: execute
depends_on: []
files_modified: [src/app/calculator/page.tsx, src/components/Calculator/ExpenseForm.tsx, src/components/Calculator/index.ts]
---

<objective>
Build the expense input form with categorized fields and city-based pre-fill.

Purpose: Allow users to input their monthly expenses by category.
Output: Functional expense form with source city selector and pre-fill capability.
</objective>

<context>
@.planning/PROJECT.md
@src/lib/data.ts
@src/types/metrics.ts

**Expense categories to include:**
- Rent (1BR default, with size options)
- Food (groceries + dining out)
- Transport (public transit or car)
- Utilities (basic + internet + mobile)
- Lifestyle (gym, entertainment)
- Healthcare (basic monthly)

**Form behavior:**
- Select source city to pre-fill with averages
- Manual override for each field
- All values in USD for consistency
- Reset to city averages button
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExpenseForm component</name>
  <files>src/components/Calculator/ExpenseForm.tsx, src/components/Calculator/index.ts</files>
  <action>
Create the expense input form component:

1. Create directory: src/components/Calculator/

2. Define expense state interface:
   ```typescript
   interface ExpenseState {
     rent: number;
     groceries: number;
     diningOut: number;
     transport: number;
     utilities: number;
     internet: number;
     mobile: number;
     gym: number;
     entertainment: number;
     healthcare: number;
   }
   ```

3. Props interface:
   ```typescript
   interface ExpenseFormProps {
     expenses: ExpenseState;
     onChange: (expenses: ExpenseState) => void;
     sourceCity: CityWithMetrics | null;
   }
   ```

4. Form layout with sections:
   ```tsx
   <div className="space-y-6">
     {/* Housing Section */}
     <FormSection title="Housing">
       <ExpenseInput label="Rent" value={expenses.rent} ... />
     </FormSection>

     {/* Food Section */}
     <FormSection title="Food">
       <ExpenseInput label="Groceries" ... />
       <ExpenseInput label="Dining Out" ... />
     </FormSection>

     {/* ... more sections */}
   </div>
   ```

5. ExpenseInput sub-component:
   - Label
   - Number input with $ prefix
   - "per month" suffix
   - Optional hint text

6. FormSection sub-component:
   - Title header
   - Grid of inputs

7. Create barrel export
  </action>
  <verify>Form renders with all expense fields</verify>
  <done>ExpenseForm component with categorized inputs</done>
</task>

<task type="auto">
  <name>Task 2: Add city selector and pre-fill</name>
  <files>src/app/calculator/page.tsx</files>
  <action>
Build calculator page with source city and pre-fill:

1. Make it a client component

2. State management:
   ```typescript
   const [sourceCityId, setSourceCityId] = useState<string | null>(null);
   const [expenses, setExpenses] = useState<ExpenseState>(defaultExpenses);
   ```

3. Pre-fill function:
   ```typescript
   const prefillFromCity = (city: CityWithMetrics) => {
     setExpenses({
       rent: city.metrics.rent.oneBedroom.usd,
       groceries: city.metrics.food.groceries.usd,
       diningOut: city.metrics.food.restaurantMeal.usd * 4, // 4 meals/month
       transport: city.metrics.transport.monthlyPass.usd,
       utilities: city.metrics.utilities.basic.usd,
       internet: city.metrics.utilities.internet.usd,
       mobile: city.metrics.utilities.mobile.usd,
       gym: city.metrics.lifestyle.gymMembership.usd,
       entertainment: city.metrics.lifestyle.cinema.usd * 2, // 2 movies/month
       healthcare: city.metrics.healthcare.medicationBasic.usd,
     });
   };
   ```

4. Page layout:
   ```tsx
   <div className="space-y-6">
     <header>
       <h1>Budget Calculator</h1>
       <p>Enter your expenses to see equivalent budget in another city.</p>
     </header>

     {/* Source city selector */}
     <div className="max-w-xs">
       <CitySelector
         cities={cityIndex}
         selectedId={sourceCityId}
         onChange={(id) => {
           setSourceCityId(id);
           const city = getCityById(id);
           if (city) prefillFromCity(city);
         }}
         label="Your Current City"
       />
     </div>

     {/* Pre-fill notice */}
     {sourceCity && (
       <p className="text-sm text-gray-600">
         Pre-filled with average costs for {sourceCity.name}.
         Adjust values to match your actual spending.
       </p>
     )}

     {/* Expense form */}
     <ExpenseForm
       expenses={expenses}
       onChange={setExpenses}
       sourceCity={sourceCity}
     />

     {/* Total display */}
     <div className="bg-gray-50 p-4 rounded-lg">
       <p>Total Monthly Expenses</p>
       <p className="text-2xl font-bold">${totalExpenses.toFixed(0)}</p>
     </div>
   </div>
   ```

5. Calculate total:
   ```typescript
   const totalExpenses = Object.values(expenses).reduce((sum, val) => sum + val, 0);
   ```
  </action>
  <verify>Selecting city pre-fills form, total updates correctly</verify>
  <done>Calculator page with source city and expense form</done>
</task>

<task type="auto">
  <name>Task 3: Add reset and validation</name>
  <files>src/components/Calculator/ExpenseForm.tsx, src/app/calculator/page.tsx</files>
  <action>
Add reset functionality and input validation:

1. Reset button:
   - "Reset to city averages" (only if source city selected)
   - "Clear all" option

2. Input validation:
   - Minimum 0
   - Maximum reasonable value (e.g., 50000)
   - Handle empty/invalid input gracefully

3. Visual feedback:
   - Show difference from city average (optional)
   - Highlight modified fields

4. Responsive layout:
   - Single column on mobile
   - Two columns on tablet/desktop
  </action>
  <verify>Reset works, inputs validate, responsive layout</verify>
  <done>Form with reset and validation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /calculator page loads
- [ ] City selector shows all cities
- [ ] Selecting city pre-fills expenses
- [ ] Can manually edit each field
- [ ] Total updates when fields change
- [ ] Reset button works
- [ ] Responsive on mobile
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Expense form fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/07-budget-calculator/07-01-SUMMARY.md`
</output>

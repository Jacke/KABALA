---
phase: 07-budget-calculator
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [src/app/calculator/page.tsx, src/components/Calculator/BudgetResults.tsx, src/components/Calculator/index.ts]
---

<objective>
Add target city selection and budget conversion calculations.

Purpose: Show users what their equivalent budget would be in a target city.
Output: Complete calculator with source/target comparison and category breakdown.
</objective>

<context>
@.planning/phases/07-budget-calculator/07-01-SUMMARY.md
@src/app/calculator/page.tsx
@src/components/Calculator/ExpenseForm.tsx

**Conversion logic:**
For each expense category, calculate the ratio between source and target city costs,
then apply that ratio to the user's actual expenses.

Example: If source city rent is $1000 and target is $1500 (1.5x ratio),
and user pays $800, their target rent would be $800 * 1.5 = $1200.

**Display:**
- Category-by-category breakdown
- Total comparison
- Percentage difference
- Visual indicators for cheaper/more expensive
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BudgetResults component</name>
  <files>src/components/Calculator/BudgetResults.tsx, src/components/Calculator/index.ts</files>
  <action>
Create component to display conversion results:

1. Props interface:
   ```typescript
   interface BudgetResultsProps {
     sourceCity: CityWithMetrics;
     targetCity: CityWithMetrics;
     expenses: ExpenseState;
   }
   ```

2. Conversion function:
   ```typescript
   function convertExpense(
     amount: number,
     sourceMetric: number,
     targetMetric: number
   ): number {
     if (sourceMetric === 0) return amount;
     const ratio = targetMetric / sourceMetric;
     return Math.round(amount * ratio);
   }
   ```

3. Calculate converted expenses for each category

4. Display layout:
   ```tsx
   <div>
     {/* Summary header */}
     <div className="bg-gradient-to-r from-blue-600 to-purple-600">
       <p>In {targetCity.name}, you would need</p>
       <p className="text-4xl font-bold">${targetTotal}</p>
       <p className="text-sm">
         {diffPercent > 0 ? '↑' : '↓'} {Math.abs(diffPercent)}% vs {sourceCity.name}
       </p>
     </div>

     {/* Category breakdown table */}
     <table>
       <tr><th>Category</th><th>Current</th><th>Target</th><th>Diff</th></tr>
       {categories.map(cat => (
         <tr>
           <td>{cat.label}</td>
           <td>${cat.source}</td>
           <td>${cat.target}</td>
           <td className={diffColor}>{cat.diff}%</td>
         </tr>
       ))}
     </table>
   </div>
   ```

5. Color coding:
   - Green: cheaper in target
   - Red: more expensive in target
   - Gray: minimal difference (<5%)

6. Update barrel export
  </action>
  <verify>Results show with correct conversions and colors</verify>
  <done>BudgetResults component with category breakdown</done>
</task>

<task type="auto">
  <name>Task 2: Integrate target city selector</name>
  <files>src/app/calculator/page.tsx</files>
  <action>
Add target city selection and results display:

1. New state:
   ```typescript
   const [targetCityId, setTargetCityId] = useState<string | null>(null);
   ```

2. Add target city selector below expense form:
   ```tsx
   <div className="bg-purple-50 rounded-lg p-4">
     <CitySelector
       cities={cityIndex}
       selectedId={targetCityId}
       onChange={setTargetCityId}
       label="Target City"
       excludeId={sourceCityId}
     />
   </div>
   ```

3. Show results when both cities selected and expenses entered:
   ```tsx
   {sourceCity && targetCity && hasExpenses && (
     <BudgetResults
       sourceCity={sourceCity}
       targetCity={targetCity}
       expenses={expenses}
     />
   )}
   ```

4. Remove placeholder hint text

5. Update page description
  </action>
  <verify>Target city selection works, results appear</verify>
  <done>Calculator shows conversion results</done>
</task>

<task type="auto">
  <name>Task 3: Add insights and polish</name>
  <files>src/components/Calculator/BudgetResults.tsx, src/app/calculator/page.tsx</files>
  <action>
Add helpful insights and visual polish:

1. Biggest savings/costs indicator:
   - "Biggest saving: Rent (-$500)"
   - "Biggest increase: Food (+$200)"

2. Purchasing power insight:
   - Compare salary ratios
   - "Your purchasing power would be X% higher/lower"

3. Summary card styling:
   - Gradient background
   - Large, clear numbers
   - Easy to scan layout

4. Responsive design:
   - Stack on mobile
   - Side-by-side comparison on desktop

5. Empty states:
   - Before target selected: "Select a target city to see your budget"
   - No expenses: "Enter your expenses above first"
  </action>
  <verify>Insights display correctly, responsive layout works</verify>
  <done>Calculator polished with insights</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Can select source and target cities
- [ ] Conversion calculates correctly
- [ ] Category breakdown shows
- [ ] Total comparison displays
- [ ] Green/red color coding works
- [ ] Biggest savings/costs shown
- [ ] Responsive on mobile
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Budget calculator fully functional
- Phase 7 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-budget-calculator/07-02-SUMMARY.md`
</output>

---
phase: 04-city-details
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [src/app/city/[slug]/page.tsx, src/components/City/CityHeader.tsx, src/components/City/index.ts]
---

<objective>
Build the full city detail page showing all metrics organized by category.

Purpose: Provide comprehensive city cost of living information in a clear, scannable layout.
Output: Functional /city/[slug] page displaying all metrics for a city.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-city-details/04-01-SUMMARY.md
@src/components/City/MetricCard.tsx
@src/components/City/MetricSection.tsx
@src/lib/data.ts
@src/lib/currency.ts
@src/types/metrics.ts

**Components available:** MetricCard, MetricSection from Plan 04-01
**Data available:** getCityById(slug) returns CityWithMetrics
**Utilities available:** formatMoney, formatCurrency

**Page requirements:**
- Display city name, country, region
- Show all metric categories in organized sections
- Dual currency display (local + USD)
- Handle city not found gracefully
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CityHeader component</name>
  <files>src/components/City/CityHeader.tsx, src/components/City/index.ts</files>
  <action>
Create header component for city detail page:

1. Props interface:
   ```typescript
   interface CityHeaderProps {
     city: CityWithMetrics;
   }
   ```

2. Display:
   - City name (text-3xl font-bold)
   - Country name
   - Region badge (colored like map markers: amber for CIS, blue for EU)
   - Average salary as hero metric (large, prominent)
   - Currency info (e.g., "Prices in EUR (€)")

3. Layout:
   - Horizontal on desktop, stacked on mobile
   - City info on left, salary highlight on right
   - Back link to homepage (← Back to map)

4. Use formatMoney for salary display with showBoth=true

5. Update barrel export to include CityHeader
  </action>
  <verify>Header renders with city info and prominent salary display</verify>
  <done>CityHeader shows city name, country, region badge, and average salary</done>
</task>

<task type="auto">
  <name>Task 2: Build city detail page with all metrics</name>
  <files>src/app/city/[slug]/page.tsx</files>
  <action>
Replace placeholder with full city detail page:

1. Data loading:
   - Import getCityById from @/lib/data
   - Get city data using slug parameter
   - Return notFound() if city doesn't exist (from next/navigation)

2. Page structure:
   ```tsx
   <div className="space-y-6">
     <CityHeader city={city} />

     {/* Grid of metric sections */}
     <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
       {/* Rent section */}
       <MetricSection title="Rent (Monthly)">
         <MetricCard label="1 Bedroom" value={city.metrics.rent.oneBedroom} ... />
         <MetricCard label="2 Bedroom" value={city.metrics.rent.twoBedroom} ... />
         <MetricCard label="3 Bedroom" value={city.metrics.rent.threeBedroom} ... />
       </MetricSection>

       {/* Property section */}
       <MetricSection title="Property (per sqm)">
         <MetricCard label="City Center" value={city.metrics.property.cityCenter} ... />
         <MetricCard label="Outside Center" value={city.metrics.property.outside} ... />
       </MetricSection>

       {/* Food section */}
       {/* Transport section */}
       {/* Utilities section */}
       {/* Lifestyle section */}
       {/* Healthcare section */}
       {/* Education section (if data exists) */}
     </div>

     {/* Data source attribution */}
     <footer className="text-sm text-gray-500">
       Last updated: {city.metrics.updatedAt}
       {city.metrics.sources && ...}
     </footer>
   </div>
   ```

3. Pass currencyCode={city.currency.code} to all MetricCards

4. Handle optional fields (education, some salary fields) - only render if data exists

5. Metadata:
   - Set page title dynamically: `${city.name}, ${city.country} - KABALA`
   - Use generateMetadata for Next.js 16
  </action>
  <verify>Page loads with all metrics displayed, handles missing city with 404</verify>
  <done>City page shows all metrics organized in sections with proper formatting</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation and polish</name>
  <files>src/app/city/[slug]/page.tsx</files>
  <action>
Final polish for city detail page:

1. Add "Back to map" link at top using Next.js Link
   - Position: top left, above header
   - Style: text-blue-600 hover:underline
   - Text: "← Back to map"

2. Ensure responsive layout:
   - Single column on mobile (< md)
   - Two columns on tablet/desktop (md and up)
   - Sections stack nicely

3. Add subtle animations:
   - Section cards with hover:shadow-md transition
   - Smooth fade-in on page load (optional, don't over-engineer)

4. Verify all sections render correctly:
   - Salary (shown in header)
   - Rent (1BR, 2BR, 3BR)
   - Property (city center, outside)
   - Food (groceries, restaurant, fast food)
   - Transport (monthly pass, taxi/km, gasoline)
   - Utilities (basic, internet, mobile)
   - Lifestyle (gym, cinema, cappuccino)
   - Healthcare (doctor, medications)
   - Education (if data exists)

5. Test with each sample city (berlin, lisbon, moscow, tbilisi)
  </action>
  <verify>All cities render correctly, navigation works, responsive layout functions</verify>
  <done>City page is polished with navigation, responsive layout, all metrics visible</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /city/berlin shows all metrics
- [ ] /city/moscow shows all metrics (different currency)
- [ ] /city/unknown returns 404
- [ ] Back link navigates to homepage
- [ ] Responsive layout works on mobile
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- City pages fully functional
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-city-details/04-02-SUMMARY.md`
</output>

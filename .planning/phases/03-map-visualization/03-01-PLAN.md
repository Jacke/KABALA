---
phase: 03-map-visualization
plan: 01
type: execute
depends_on: []
files_modified: [package.json, src/components/Map/WorldMap.tsx, src/components/Map/CityMarker.tsx, src/components/Map/index.ts]
---

<objective>
Create the interactive world map component with city markers using react-simple-maps.

Purpose: Provide a visual entry point for exploring cities by clicking on the map.
Output: WorldMap component with clickable city markers showing all cities from the database.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-data-layer/02-01-SUMMARY.md
@.planning/phases/02-data-layer/02-02-SUMMARY.md
@src/types/city.ts
@src/lib/data.ts

**Tech stack available:** Next.js 16.1.4, React 19, TypeScript 5, Tailwind 4
**Data available:** getCityIndex() returns CityIndex[] with id, name, country, region, coordinates

**Library choice:** react-simple-maps (SVG-based, lightweight, works well with Next.js)
- No tile loading, no external API keys
- SVG markers fully styleable with Tailwind/CSS
- Works with d3-geo projections
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-simple-maps and dependencies</name>
  <files>package.json</files>
  <action>
Install react-simple-maps and its peer dependencies:

```bash
npm install react-simple-maps d3-geo
npm install -D @types/d3-geo
```

react-simple-maps provides:
- ComposableMap - container component
- Geographies/Geography - render world map shapes
- Marker - position elements at coordinates
- ZoomableGroup - pan/zoom support

d3-geo provides projection functions for coordinate transformation.
  </action>
  <verify>npm ls react-simple-maps shows installed, npm run build succeeds</verify>
  <done>react-simple-maps and d3-geo installed with TypeScript types</done>
</task>

<task type="auto">
  <name>Task 2: Create WorldMap component</name>
  <files>src/components/Map/WorldMap.tsx</files>
  <action>
Create the main map component:

1. Use 'use client' directive (react-simple-maps requires client-side rendering)

2. Import from react-simple-maps:
   - ComposableMap with projectionConfig for geoMercator
   - Geographies + Geography for world shape
   - ZoomableGroup for pan/zoom

3. Use Natural Earth world TopoJSON for map data:
   - URL: https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json
   - This is a free CDN-hosted world map topology

4. Props interface:
   ```typescript
   interface WorldMapProps {
     cities: CityIndex[];
     onCityClick?: (cityId: string) => void;
     selectedCityId?: string;
   }
   ```

5. Render:
   - ComposableMap with projectionConfig centered on Europe (roughly [10, 50])
   - ZoomableGroup with sensible min/max zoom
   - Geographies for land masses (light gray fill, subtle stroke)
   - Map over cities prop and render CityMarker for each

6. Styling:
   - Container: relative, full width, aspect-ratio 2/1
   - Land: fill-gray-100, stroke-gray-300
   - Water: bg-blue-50 on container

Keep simple - no clustering yet (we have 4 cities).
  </action>
  <verify>Component renders without errors in Next.js dev mode</verify>
  <done>WorldMap component renders world map with Geography shapes</done>
</task>

<task type="auto">
  <name>Task 3: Create CityMarker component</name>
  <files>src/components/Map/CityMarker.tsx, src/components/Map/index.ts</files>
  <action>
Create the city marker component:

1. Props interface:
   ```typescript
   interface CityMarkerProps {
     city: CityIndex;
     isSelected?: boolean;
     onClick?: () => void;
   }
   ```

2. Use Marker from react-simple-maps:
   - coordinates prop: [city.coordinates.lng, city.coordinates.lat]
   - Note: react-simple-maps uses [lng, lat] order (GeoJSON standard)

3. Render inside Marker:
   - Circle (SVG): r=6, fill based on region (CIS=amber, EU=blue)
   - Selected state: larger radius (r=8), ring effect
   - Hover state: cursor-pointer, slight scale up
   - Use Tailwind classes via className on SVG elements

4. Accessibility:
   - role="button" on clickable element
   - aria-label with city name
   - tabIndex for keyboard navigation

5. Create barrel export in index.ts:
   ```typescript
   export { WorldMap } from './WorldMap';
   export { CityMarker } from './CityMarker';
   ```

Region colors:
- CIS: amber-500 (#f59e0b)
- EU: blue-500 (#3b82f6)
- Other: gray-500 (#6b7280)
  </action>
  <verify>Markers render at correct positions, onClick fires, hover states work</verify>
  <done>CityMarker renders colored circles at city coordinates, clickable with hover states</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Map renders with world geography
- [ ] All 4 cities show markers at correct positions
- [ ] Markers are clickable and show hover state
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Map component is reusable with props
- Ready for tooltip/interaction layer in Plan 03-02
</success_criteria>

<output>
After completion, create `.planning/phases/03-map-visualization/03-01-SUMMARY.md`
</output>

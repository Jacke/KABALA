---
phase: 03-map-visualization
plan: 02
type: execute
depends_on: ["03-01"]
files_modified: [src/components/Map/CityTooltip.tsx, src/components/Map/WorldMap.tsx, src/app/page.tsx, src/components/Map/index.ts]
---

<objective>
Add hover tooltips and click interactions to the map, integrate map into homepage.

Purpose: Enable users to preview city info on hover and navigate to city details on click.
Output: Interactive map with tooltips showing city name and key metrics, integrated into homepage.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-map-visualization/03-01-SUMMARY.md
@src/components/Map/WorldMap.tsx
@src/components/Map/CityMarker.tsx
@src/lib/data.ts
@src/lib/currency.ts

**Tech stack available:** Next.js 16.1.4, React 19, TypeScript 5, Tailwind 4
**Components available:** WorldMap, CityMarker from Plan 03-01
**Data available:** getCityById() returns CityWithMetrics with full metrics

**Interaction requirements:**
- Hover: Show tooltip with city name, country, avg salary
- Click: Navigate to /city/[slug] page
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CityTooltip component</name>
  <files>src/components/Map/CityTooltip.tsx</files>
  <action>
Create tooltip component for city hover preview:

1. Props interface:
   ```typescript
   interface CityTooltipProps {
     city: CityWithMetrics;
     position: { x: number; y: number };
   }
   ```

2. Render a floating card:
   - Position absolute, transform to offset from cursor
   - Use position.x and position.y from mouse event
   - z-index to appear above map

3. Content:
   - City name (bold)
   - Country
   - Average salary: use formatMoney() from currency.ts
   - Small indicator of region (colored dot matching marker)

4. Styling:
   - bg-white rounded-lg shadow-lg
   - p-3, min-w-[180px]
   - Subtle border
   - Pointer-events-none (tooltip shouldn't capture mouse)

5. Animation:
   - opacity transition for smooth appear/disappear
   - Use Tailwind transition classes

Keep simple - no complex positioning logic, just offset from cursor.
  </action>
  <verify>Tooltip renders with correct data, positioned near provided coordinates</verify>
  <done>CityTooltip shows city name, country, and formatted salary</done>
</task>

<task type="auto">
  <name>Task 2: Add hover and click handling to WorldMap</name>
  <files>src/components/Map/WorldMap.tsx, src/components/Map/index.ts</files>
  <action>
Enhance WorldMap with interactive state:

1. Add state for hovered city:
   ```typescript
   const [hoveredCity, setHoveredCity] = useState<{
     city: CityWithMetrics;
     position: { x: number; y: number };
   } | null>(null);
   ```

2. Modify CityMarker usage:
   - Pass onMouseEnter handler that:
     - Fetches full city data: getCityById(city.id)
     - Captures mouse position from event
     - Sets hoveredCity state
   - Pass onMouseLeave handler that clears hoveredCity

3. Handle click:
   - Use Next.js router (useRouter from next/navigation)
   - On marker click: router.push(`/city/${city.id}`)

4. Render CityTooltip when hoveredCity is set:
   - Position using hoveredCity.position
   - Pass hoveredCity.city data

5. Update WorldMap props:
   ```typescript
   interface WorldMapProps {
     cities: CityIndex[];
     selectedCityId?: string;
     // Remove onCityClick - handle internally with router
   }
   ```

6. Update barrel export to include CityTooltip

Mouse position handling:
- Use event.clientX, event.clientY from onMouseEnter
- These give position relative to viewport
- Tooltip will be fixed positioned
  </action>
  <verify>Hover shows tooltip, click navigates to city page, tooltip disappears on mouse leave</verify>
  <done>WorldMap shows tooltips on hover, navigates on click</done>
</task>

<task type="auto">
  <name>Task 3: Integrate map into homepage</name>
  <files>src/app/page.tsx</files>
  <action>
Replace homepage placeholder with actual map:

1. Make page a client component ('use client') since map requires client rendering

2. Import:
   - WorldMap from '@/components/Map'
   - getCityIndex from '@/lib/data'

3. Get city data:
   - Call getCityIndex() to get lightweight city list
   - Pass to WorldMap component

4. Layout:
   - Keep existing heading "World Map"
   - Add subtitle explaining interaction
   - Replace placeholder div with WorldMap
   - Map container: full width, max-w-6xl, rounded-lg overflow-hidden

5. Add legend below map:
   - Simple flex row with colored dots
   - "CIS" with amber dot, "EU" with blue dot
   - Small text, gray-500

Styling:
- Container: bg-white rounded-xl shadow-sm p-4
- Responsive padding/margins
- Map takes full container width
  </action>
  <verify>Homepage shows interactive map, hover/click work, legend displays</verify>
  <done>Homepage displays WorldMap with all cities, interactive tooltips, and legend</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Hovering over marker shows tooltip with city info
- [ ] Clicking marker navigates to /city/[slug]
- [ ] Tooltip disappears when mouse leaves marker
- [ ] Legend shows region colors
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Map is the primary homepage content
- Users can discover and navigate to any city
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-map-visualization/03-02-SUMMARY.md`
</output>

---
phase: 09-sharing-features
plan: 01
type: execute
depends_on: []
files_modified: [src/app/layout.tsx, src/app/calculator/page.tsx, src/app/rankings/page.tsx, src/app/compare/page.tsx]
---

<objective>
Review and enhance metadata across all pages, add URL state to calculator.

Purpose: Ensure all pages are shareable with proper metadata.
Output: Consistent metadata and URL state across the app.
</objective>

<context>
**Existing metadata:**
- City pages: Dynamic title/description via generateMetadata
- Rankings page: Static metadata
- Compare page: Client component (no metadata export)
- Calculator page: Client component (no metadata export)

**URL state status:**
- Compare page: Already has URL state (/compare?cities=...)
- Calculator page: Needs URL state for source/target cities

**Meta tags needed:**
- title, description (already have)
- og:title, og:description, og:image
- twitter:card, twitter:title, twitter:description
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add default OG metadata to layout</name>
  <files>src/app/layout.tsx</files>
  <action>
Add default Open Graph metadata to root layout:

1. Update metadata export:
   ```typescript
   export const metadata: Metadata = {
     title: {
       default: 'KABALA - Cost of Living Comparison',
       template: '%s | KABALA',
     },
     description: 'Compare cost of living across cities...',
     openGraph: {
       title: 'KABALA - Cost of Living Comparison',
       description: 'Compare salaries, rent, and living costs...',
       type: 'website',
       locale: 'en_US',
       siteName: 'KABALA',
     },
     twitter: {
       card: 'summary_large_image',
       title: 'KABALA - Cost of Living Comparison',
       description: 'Compare salaries, rent, and living costs...',
     },
   };
   ```

2. This provides defaults that pages can override
  </action>
  <verify>Root layout has OG and Twitter metadata</verify>
  <done>Default OG metadata added to layout</done>
</task>

<task type="auto">
  <name>Task 2: Add URL state to calculator</name>
  <files>src/app/calculator/page.tsx</files>
  <action>
Add URL state for source and target cities:

1. URL format: /calculator?from=berlin&to=moscow

2. Import useSearchParams and useRouter

3. Initialize from URL on mount:
   ```typescript
   useEffect(() => {
     const from = searchParams.get('from');
     const to = searchParams.get('to');
     if (from && validCityIds.has(from)) {
       handleSourceCityChange(from);
     }
     if (to && validCityIds.has(to)) {
       setTargetCityId(to);
     }
   }, []);
   ```

4. Update URL when cities change:
   ```typescript
   useEffect(() => {
     const params = new URLSearchParams();
     if (sourceCityId) params.set('from', sourceCityId);
     if (targetCityId) params.set('to', targetCityId);
     const url = params.toString() ? `/calculator?${params}` : '/calculator';
     router.replace(url, { scroll: false });
   }, [sourceCityId, targetCityId]);
   ```

5. Wrap in Suspense for useSearchParams
  </action>
  <verify>Calculator URL updates with city selections</verify>
  <done>Calculator has shareable URL state</done>
</task>

<task type="auto">
  <name>Task 3: Add metadata to static pages</name>
  <files>src/app/rankings/page.tsx</files>
  <action>
Enhance rankings page metadata:

```typescript
export const metadata: Metadata = {
  title: 'City Rankings',
  description: 'Compare and rank cities by salary, rent, and cost of living metrics.',
  openGraph: {
    title: 'City Rankings - KABALA',
    description: 'Compare and rank cities by salary, rent, and cost of living.',
  },
};
```

Already has basic metadata, just ensure OG tags are included.
  </action>
  <verify>Rankings page has complete metadata</verify>
  <done>Static pages have enhanced metadata</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Root layout has default OG metadata
- [ ] Calculator URL reflects city selections
- [ ] Loading calculator URL restores selections
- [ ] Rankings page has OG metadata
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- All pages have proper metadata
</success_criteria>

<output>
After completion, create `.planning/phases/09-sharing-features/09-01-SUMMARY.md`
</output>

---
phase: 09-sharing-features
plan: 02
type: execute
depends_on: ["09-01"]
files_modified: [src/app/opengraph-image.tsx, src/app/city/[slug]/opengraph-image.tsx]
---

<objective>
Create dynamic Open Graph images for social media sharing.

Purpose: Generate attractive preview images when links are shared on social media.
Output: Dynamic OG images for homepage and city pages.
</objective>

<context>
**Next.js ImageResponse:**
- Built-in API for generating OG images
- Uses Satori for rendering JSX to images
- File convention: opengraph-image.tsx
- Automatically linked in metadata

**Image requirements:**
- Size: 1200x630 (standard OG size)
- Format: PNG
- Content: App branding, key info

**Pages needing OG images:**
- Homepage: App name, tagline
- City pages: City name, key stats
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create default OG image</name>
  <files>src/app/opengraph-image.tsx</files>
  <action>
Create default OG image for homepage:

```typescript
import { ImageResponse } from 'next/og';

export const runtime = 'edge';

export const alt = 'KABALA - Global Purchasing Power Dashboard';
export const size = { width: 1200, height: 630 };
export const contentType = 'image/png';

export default async function Image() {
  return new ImageResponse(
    (
      <div
        style={{
          background: 'linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%)',
          width: '100%',
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          fontFamily: 'Inter, sans-serif',
        }}
      >
        <div style={{ fontSize: 72, fontWeight: 'bold', color: 'white' }}>
          KABALA
        </div>
        <div style={{ fontSize: 32, color: '#e0e7ff', marginTop: 20 }}>
          Global Purchasing Power Dashboard
        </div>
        <div style={{ fontSize: 24, color: '#c7d2fe', marginTop: 40 }}>
          Compare cost of living across cities
        </div>
      </div>
    ),
    { ...size }
  );
}
```
  </action>
  <verify>OG image generates at /opengraph-image</verify>
  <done>Default OG image created</done>
</task>

<task type="auto">
  <name>Task 2: Create city page OG images</name>
  <files>src/app/city/[slug]/opengraph-image.tsx</files>
  <action>
Create dynamic OG images for city pages:

```typescript
import { ImageResponse } from 'next/og';
import { getCityById } from '@/lib/data';

export const runtime = 'edge';
export const alt = 'City Cost of Living';
export const size = { width: 1200, height: 630 };
export const contentType = 'image/png';

export default async function Image({ params }: { params: { slug: string } }) {
  const city = getCityById(params.slug);

  if (!city) {
    return new ImageResponse(
      <div>City not found</div>,
      { ...size }
    );
  }

  const salary = city.metrics.salary.average.usd;
  const rent = city.metrics.rent.oneBedroom.usd;

  return new ImageResponse(
    (
      <div
        style={{
          background: 'linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%)',
          width: '100%',
          height: '100%',
          display: 'flex',
          flexDirection: 'column',
          padding: 60,
          fontFamily: 'Inter, sans-serif',
        }}
      >
        {/* Header */}
        <div style={{ color: '#c7d2fe', fontSize: 24 }}>KABALA</div>

        {/* City name */}
        <div style={{ fontSize: 64, fontWeight: 'bold', color: 'white', marginTop: 40 }}>
          {city.name}
        </div>
        <div style={{ fontSize: 32, color: '#e0e7ff' }}>
          {city.country}
        </div>

        {/* Stats */}
        <div style={{ display: 'flex', marginTop: 60, gap: 80 }}>
          <div>
            <div style={{ color: '#c7d2fe', fontSize: 20 }}>Avg. Salary</div>
            <div style={{ color: 'white', fontSize: 40, fontWeight: 'bold' }}>
              ${salary.toLocaleString()}/mo
            </div>
          </div>
          <div>
            <div style={{ color: '#c7d2fe', fontSize: 20 }}>1BR Rent</div>
            <div style={{ color: 'white', fontSize: 40, fontWeight: 'bold' }}>
              ${rent.toLocaleString()}/mo
            </div>
          </div>
        </div>
      </div>
    ),
    { ...size }
  );
}
```
  </action>
  <verify>City OG images generate with dynamic data</verify>
  <done>City page OG images created</done>
</task>

<task type="auto">
  <name>Task 3: Update metadata to reference OG images</name>
  <files>src/app/city/[slug]/page.tsx</files>
  <action>
Next.js automatically links opengraph-image.tsx files.
Verify metadata includes image references:

1. Check that generateMetadata in city page works correctly
2. Images are automatically referenced when opengraph-image.tsx exists
3. Test by building and checking generated HTML
  </action>
  <verify>Metadata includes OG image references</verify>
  <done>Metadata linked to OG images</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] /opengraph-image generates default image
- [ ] /city/berlin/opengraph-image generates city image
- [ ] City images show city name and stats
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- OG images generate for sharing
- Phase 9 complete
</success_criteria>

<output>
After completion, create `.planning/phases/09-sharing-features/09-02-SUMMARY.md`
</output>
